name: Compilar SA-MP Pawn (FINAL REAL)

on:
  push:
    paths:
      - "gamemodes/cidade_real.pwn"
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Baixar Pawn Compiler 3.10.10
      run: |
        set -e
        wget github.com
        tar -xzf pawnc-3.10.10-linux.tar.gz
        chmod +x pawnc-3.10.10-linux/bin/pawncc

    - name: Instalar libpawnc.so
      run: |
        set -e
        LIB_PATH=$(find pawnc-3.10.10-linux -name "libpawnc.so" | head -n 1)
        sudo cp "$LIB_PATH" /usr/lib/
        sudo ldconfig

    - name: Baixar Includes open.mp
      run: |
        git clone --depth 1 github.com omp_includes

    - name: Compilar Cidade Real
      run: |
        mkdir -p build
        ./pawnc-3.10.10-linux/bin/pawncc "gamemodes/cidade_real.pwn" \
          -i"omp_includes" \
          -i"include" \
          -o"build/cidade_real.amx"

    - name: Upload dos AMX
      uses: actions/upload-artifact@v4
      with:
        name: samp-amx
        path: build/cidade_real.amx
