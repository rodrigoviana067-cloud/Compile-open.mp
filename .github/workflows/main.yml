name: Build Cidade Real

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Baixar open.mp
        run: |
          wget https://github.com/openmultiplayer/open.mp/releases/latest/download/open.mp-linux-x86.tar.gz
          tar -xzf open.mp-linux-x86.tar.gz
          ls -la

      - name: Localizar pawncc
        run: |
          PAWNCC=$(find . -type f -name pawncc | head -n 1)

          if [ -z "$PAWNCC" ]; then
            echo "pawncc nao encontrado"
            exit 1
          fi

          chmod +x "$PAWNCC"
          echo "PAWNCC=$PAWNCC" >> $GITHUB_ENV

      - name: Compilar Gamemode
        run: |
          mkdir -p build/gamemodes

          PAWN_DIR=$(dirname "$PAWNCC")
          export LD_LIBRARY_PATH=$PAWN_DIR:$LD_LIBRARY_PATH

          "$PAWNCC" gamemodes/cidade_real.pwn \
            -i"$PAWN_DIR/include" \
            -o"build/gamemodes/cidade_real.amx" \
            -d3 -Z+ -O1
