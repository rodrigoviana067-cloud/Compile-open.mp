name: Compilar Cidade Real (open.mp)

on:
  push:
    paths:
      - "gamemodes/cidade_real.pwn"
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Baixar Pawn Compiler 3.10.10
      run: |
        set -e
        # Usando -L para evitar o erro de download que você teve antes
        wget -L https://github.com/pawn-lang/compiler/releases/download/v3.10.10/pawnc-3.10.10-linux.tar.gz
        tar -xzf pawnc-3.10.10-linux.tar.gz
        chmod +x pawnc-3.10.10-linux/bin/pawncc

    - name: Instalar libpawnc.so
      run: |
        set -e
        LIB_PATH=$(find pawnc-3.10.10-linux -name "libpawnc.so" | head -n 1)
        sudo cp "$LIB_PATH" /usr/lib/
        sudo ldconfig

    # ESSA É A PARTE QUE FALTAVA PARA O OPEN.MP
    - name: Baixar Includes do open.mp
      run: |
        git clone --depth 1 github.com omp_includes

    - name: Compilar Cidade Real
      run: |
        set -e
        mkdir -p compiled/gamemodes
        ./pawnc-3.10.10-linux/bin/pawncc "gamemodes/cidade_real.pwn" \
          -iomp_includes \
          -iinclude \
          -i./pawnc-3.10.10-linux/include \
          -o"compiled/gamemodes/cidade_real.amx"

    - name: Upload dos AMX
      uses: actions/upload-artifact@v4
      with:
        name: CidadeReal-OMP
        path: compiled/gamemodes/cidade_real.amx
