name: Build Cidade Real

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Baixar open.mp oficial
        run: |
          wget https://github.com/openmultiplayer/open.mp/releases/latest/download/open.mp-linux-x86.tar.gz
          tar -xzf open.mp-linux-x86.tar.gz

      - name: Compilar Gamemode (open.mp)
        run: |
          mkdir -p build/gamemodes

          # Encontrar a pasta extra√≠da automaticamente
          OMP_DIR=$(find . -maxdepth 1 -type d -name "open.mp*")

          chmod +x "$OMP_DIR/pawncc"
          chmod +x "$OMP_DIR/libpawnc.so"

          export LD_LIBRARY_PATH=$GITHUB_WORKSPACE/$OMP_DIR:$LD_LIBRARY_PATH

          "$OMP_DIR/pawncc" gamemodes/cidade_real.pwn \
            -i"$OMP_DIR/include" \
            -o"build/gamemodes/cidade_real.amx" \
            -d3 -Z+ -O1
